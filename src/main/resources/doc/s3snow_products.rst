.. |vspace| raw:: latex

   \vspace{5mm}

.. |br| raw:: html

   <br />

.. index:: SNAP Cawa Products
.. _cawa_products:

======================
The SNAP CAWA Products
======================

Overview
========

This section will give an overview of all input, intermediate and final products used and generated by the SNAP
GPF TCWV and CTP processors


.. index:: Input Products

Input Products
==============

MERIS L1b TOA Radiance Products
-------------------------------

From the MERIS full mission (2002-2012), L1b TOA radiance reduced resolution data has
been used as input data. Table :numref:`meris_bands_l1b` to :numref:`meris_l1b_flag_coding` give an overview of
MERIS L1b bands, tie point grids and L1b flag coding, respectively. A more detailed description of the MERIS
standard L1b product is given in [`13 <intro.html#References>`_].

|vspace| |br|

.. _meris_bands_l1b:
.. table:: MERIS bands in L1b product

    +-----------------------------+---------------------+------------+-----------------------------+
    |     **Name in product**     |       **Unit**      |   **Type** |        **Description**      |
    +=============================+=====================+============+=============================+
    | radiance_<n>; n=1,..,15     | mW/(m^2*sr*nm)      | float32    | TOA radiance in band <n>    |
    +-----------------------------+---------------------+------------+-----------------------------+
    |       l1_flags              | dl (flag band)      | uint8      | Level 1b flags              |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    detector_index           |        dl           | int16      | Detector index              |
    +-----------------------------+---------------------+------------+-----------------------------+

|vspace| |br|

.. _meris_instrument_channels:
.. table:: MERIS instrument channels.

    +-------------------------------+------------------------------+-------------------------------+
    | **Channel**                   | **Wavelength**               | **Bandwidth**                 |
    +===============================+==============================+===============================+
    | 1                             | 412.5                        | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 2                             | 442.5                        | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 3                             | 490                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 4                             | 510                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 5                             | 560                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 6                             | 620                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 7                             | 665                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 8                             | 681                          | 7.5                           |
    +-------------------------------+------------------------------+-------------------------------+
    | 9                             | 709                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 10                            | 753                          | 7.5                           |
    +-------------------------------+------------------------------+-------------------------------+
    | 11                            | 761                          | 3.75                          |
    +-------------------------------+------------------------------+-------------------------------+
    | 12                            | 778                          | 15                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 13                            | 865                          | 20                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 14                            | 885                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+
    | 15                            | 900                          | 10                            |
    +-------------------------------+------------------------------+-------------------------------+

|vspace| |br|

.. _meris_tpgs:
.. table:: MERIS tie point grids in L1b product.

    +--------------------+----------+--------------+-----------------------------------------------+
    | **Name in product**| **Unit** |   **Type**   |        **Description**                        |
    +====================+==========+==============+===============================================+
    | latitude           |   deg    |   float32    | Latitude of the tie points                    |
    +--------------------+----------+--------------+-----------------------------------------------+
    | longitude          |   deg    |   float32    | Longitude of the tie points                   |
    +--------------------+----------+--------------+-----------------------------------------------+
    | dem_alt            |   m      |   float32    | Digital elevation model altitude              |
    +--------------------+----------+--------------+-----------------------------------------------+
    | dem_rough          |   m      |   float32    | Digital elevation model roughness             |
    +--------------------+----------+--------------+-----------------------------------------------+
    | lat_corr           |   deg    |   float32    | Digital elevation model latitude corrections  |
    +--------------------+----------+--------------+-----------------------------------------------+
    | lon_corr           |   deg    |   float32    | Digital elevation model longitude corrections |
    +--------------------+----------+--------------+-----------------------------------------------+
    | sun_zenith         |   deg    |   float32    | Sun zenith angle                              |
    +--------------------+----------+--------------+-----------------------------------------------+
    | sun_azimuth        |   deg    |   float32    | Sun azimuth angle                             |
    +--------------------+----------+--------------+-----------------------------------------------+
    | view_zenith        |   deg    |   float32    | View zenith angle                             |
    +--------------------+----------+--------------+-----------------------------------------------+
    | view_azimuth       |   deg    |   float32    | View azimuth angle                            |
    +--------------------+----------+--------------+-----------------------------------------------+
    | zonal_wind         |   m/s    |   float32    | Zonal wind                                    |
    +--------------------+----------+--------------+-----------------------------------------------+
    | merid_wind         |   m/s    |   float32    | Meridional wind                               |
    +--------------------+----------+--------------+-----------------------------------------------+
    | atm_press          |   hPa    |   float32    | Mean sea level pressure                       |
    +--------------------+----------+--------------+-----------------------------------------------+
    | ozone              |   DU     |   float32    | Total ozone                                   |
    +--------------------+----------+--------------+-----------------------------------------------+
    | rel_hum            |   %      |   float32    | Relative humidity                             |
    +--------------------+----------+--------------+-----------------------------------------------+

|vspace| |br|

.. _meris_l1b_flag_coding:
.. table:: MERIS L1b flag coding.

    +-------------------------------+------------------------------+-------------------------------+
    | **Bit**                       | **Flag**                     | **Description**               |
    +===============================+==============================+===============================+
    | 0                             | Cosmetic                     | Pixel is cosmetic             |
    +-------------------------------+------------------------------+-------------------------------+
    | 1                             | Duplicated                   | Pixel has been duplicated     |
    +-------------------------------+------------------------------+-------------------------------+
    | 2                             | Glint_Risk                   | Pixel has glint risk          |
    +-------------------------------+------------------------------+-------------------------------+
    | 3                             | Suspect                      | Pixel is suspect              |
    +-------------------------------+------------------------------+-------------------------------+
    | 4                             | Land_Ocean                   | Pixel is over land,           |
    +-------------------------------+------------------------------+-------------------------------+
    | 5                             | Bright                       | Pixel is bright               |
    +-------------------------------+------------------------------+-------------------------------+
    | 6                             | Coastline                    | Pixel is part of a coastline  |
    +-------------------------------+------------------------------+-------------------------------+


|vspace| |br|

In the CAWA TCWV processing, the following bands and tie point grids from the MERIS L1b products are used:

- radiance_13 (converted to TOA reflectance)
- radiance_14 (converted to TOA reflectance)
- radiance_15 (converted to TOA reflectance)
- sun_zenith
- sun_azimuth
- view_zenith
- view_azimuth

In the CAWA CTP processing, the following bands and tie point grids from the MERIS L1b products are used:

- radiance_10
- radiance_11
- detector_index
- sun_zenith
- sun_azimuth
- view_zenith
- view_azimuth
- dem_alt


MODIS MYD021 TOA Reflectance Products
-------------------------------------

For the 'OLCI-like' TCWV processing in CAWA, MODIS Aqua L1b data from MYD021KM products were used. These products
contain calibrated Earth view TOA reflectance data at 1km resolution, including the 250m and 500m resolution bands
aggregated to 1km resolution. The datasets are described in detail in the MODIS Level 1B Product User's Guide
[`14 <intro.html#References>`_]. :numref:`modis_tpgs` gives an overview of the reflective and emissive
bands in the MYD021KM product.

|vspace| |br|

.. _modis_bds:
.. table:: MODIS Aqua bands in L1b MYD021 product. Taken from [`14 <intro.html#References>`_].

    +-------------------------------+-------------------------+------------------------------------+
    |     **Cryptic name**          | **Resolution**          |        **Spectral bands**          |
    +===============================+=========================+====================================+
    | EV_250_RefSB                  | 250m                    | 1, 2                               |
    +-------------------------------+-------------------------+------------------------------------+
    | EV_500_RefSB                  | 500m                    | 3-7                                |
    +-------------------------------+-------------------------+------------------------------------+
    | EV_1KM_RefSB                  | 1km                     | 8-19, 26                           |
    +-------------------------------+-------------------------+------------------------------------+
    | EV_1KM_Emissive               | 1km                     | 20-25, 27-36                       |
    +-------------------------------+-------------------------+------------------------------------+

Here, "RefSB" stands for "Reflective Solar Band" and "Emissive" stands for thermal emissive bands.

|vspace| |br|

:numref:`modis_tpgs` gives an overview of the tie piont grids available in the MYD021KM product.

|vspace| |br|

.. _modis_tpgs:
.. table:: MODIS tie point grids in L1b MYD021 product.

    +--------------------+----------+--------------+-----------------------------------------------+
    | **Name in product**| **Unit** |   **Type**   |        **Description**                        |
    +====================+==========+==============+===============================================+
    | latitude           |   deg    |   float32    | Latitude of the tie points (WGS-84),          |
    |                    |          |              | Greenwich origin, positive N                  |
    +--------------------+----------+--------------+-----------------------------------------------+
    | longitude          |   deg    |   float32    | Longitude of the tie points (WGS-84),         |
    |                    |          |              | Greenwich origin, positive E                  |
    +--------------------+----------+--------------+-----------------------------------------------+
    | Height             |   m      |   float32    | Height                                        |
    +--------------------+----------+--------------+-----------------------------------------------+
    | Range              |   m      |   float32    | Range                                         |
    +--------------------+----------+--------------+-----------------------------------------------+
    | SolarZenith        |   deg    |   float32    | Sun zenith angle                              |
    +--------------------+----------+--------------+-----------------------------------------------+
    | SolarAzimuth       |   deg    |   float32    | Sun azimuth angle                             |
    +--------------------+----------+--------------+-----------------------------------------------+
    | SensorZenith       |   deg    |   float32    | View zenith angle                             |
    +--------------------+----------+--------------+-----------------------------------------------+
    | SensorAzimuth      |   deg    |   float32    | View azimuth angle                            |
    +--------------------+----------+--------------+-----------------------------------------------+

|vspace| |br|

In the CAWA TCWV processing, the following bands and tie point grids from these products are used:

- EV_250_Aggr1km_RefSB_2
- EV_250_Aggr1km_RefSB_5
- EV_1KM_RefSB_17
- EV_1KM_RefSB_18
- EV_1KM_RefSB_19
- SolarZenith
- SolarAzimuth
- SensorZenith
- SensorAzimuth


.. index:: Intermediate Products

Intermediate Products
=====================

ERA-Interim Products (optional)
-------------------------------

The CAWA TCWV algorithm uses the following prior variables:

- temperature at 2m
- mean sea level pressure
- TCWV initial guess
- windspeed at 10m, u-component
- windspeed at 10m, v-component

As said, the way of providing these prior variables to the algorithms is somewhat arbitrary.
In the CAWA TCWV processing on the BC Calvalus cluster, the variables were taken from available ERA-Interim
reanalysis datasets. The ERA-Interim data extraction and preparation was done with specific scripts which were
developed in the frame of other projects and which are running on Calvalus, making use of the collection of
Climate Data Operators (CDO) developed at Max-Planck-Institute for Meteorology Hamburg [`15 <intro.html#References>`_].
All these components are not part of the CAWA software package.
However, the content of the ERA-Interim products being resampled and collocated with the MERIS/MODIS L1b input
products is given in Table :numref:`erainterim_bands`.

|vspace| |br|

.. _erainterim_bands:
.. table:: Bands in ERA-Interim product

    +-----------------------------+---------------------+------------+-----------------------------+
    |     **Name in product**     |       **Unit**      |   **Type** |        **Description**      |
    +=============================+=====================+============+=============================+
    |    t2m                      | K                   | float32    | temperature at 2m           |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    msl                      | hPa                 | float32    | mean sea level pressure     |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    tcwv                     |        kgm-2        | float32    | TCWV initial guess          |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    u10                      |        m/s          | float32    | windspeed 10m, u-component  |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    v10                      |        m/s          | float32    | windspeed 10m, v-component  |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    latitude                 |        deg          | float32    | latitude                    |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    longitude                |        deg          | float32    | longitude                   |
    +-----------------------------+---------------------+------------+-----------------------------+


SNAP IdePix Classification Products
-----------------------------------


The IdePix classification product is the result of the pixel classification performed on the MERIS or MODIS L1b
products for both TCWV and CTP processing. In return, the IdePix product is used as input for the TCWV and CTP
processing. In fact it is an 'extended' classification product containing the following information:

- radiance/reflectance bands needed for TCWV/CTP retrieval
- pixel classification flag band
- prior variables in case of TCWV processing(for CAWA, obtained from collocation with ERA-Interim product described above)
- L1b flags and tie point grids


The IdePix classification flag coding is given in  Table :numref:`idepix_flag_coding`.
(Some of the flags may not be computed under certain conditions. E.g., a glint risk is not computed for land pixels.)

|vspace| |br|

.. _idepix_flag_coding:
.. table:: IdePix classification flag coding.

    +------------+-------------------+-------------------------------------------------------------+
    | **Bit**    | **Flag**          | **Description**                                             |
    +============+===================+=============================================================+
    | 0          | INVALID           | Pixel is invalid                                            |
    +------------+-------------------+-------------------------------------------------------------+
    | 1          | CLOUD             | Pixel is either 'cloud sure' or 'cloud ambiguous'           |
    +------------+-------------------+-------------------------------------------------------------+
    | 2          | CLOUD_AMBIGUOUS   | Semi-transparent clouds, or cloud detection is uncertain    |
    +------------+-------------------+-------------------------------------------------------------+
    | 3          | CLOUD_SURE        | Fully opaque clouds with full confidence of their detection |
    +------------+-------------------+-------------------------------------------------------------+
    | 4          | CLOUD_BUFFER      | A buffer of N pixels (user option) around a cloud           |
    +------------+-------------------+-------------------------------------------------------------+
    | 5          | CLOUD_SHADOW      | Pixel is affected by a cloud shadow                         |
    +------------+-------------------+-------------------------------------------------------------+
    | 6          | SNOW_ICE          | Snow or ice pixel                                           |
    +------------+-------------------+-------------------------------------------------------------+
    | 7          | GLINTRISK         | Pixel has glint risk (over ocean)                           |
    +------------+-------------------+-------------------------------------------------------------+
    | 8          | COASTLINE         | Pixel is part of a coastline                                |
    +------------+-------------------+-------------------------------------------------------------+
    | 9          | LAND              | Land pixel                                                  |
    +------------+-------------------+-------------------------------------------------------------+

|vspace| |br|

The IdePix products are generated in NetCDF4 format. An example of the NetCDF header of an Idepix product is
given in the :ref:`annex`.

.. index:: Final Products

Final Products
==============

CAWA TCWV Products
------------------

The CAWA TCWV final products are generated in CF-compliant NetCDF4 format. They just contain the TCWV, a simple
TCWV flag and the pixel classification flag copied from the IdePix product (:numref:`tcwv_bands`).
An example of the NetCDF header of a TCWV product is given in the :ref:`annex`.

|vspace| |br|

.. _tcwv_bands:
.. table:: Bands in final CAWA TCWV product

    +-----------------------------+---------------------+------------+-----------------------------+
    |     **Name in product**     |       **Unit**      |   **Type** |        **Description**      |
    +=============================+=====================+============+=============================+
    |         tcwv                | mm                  | float32    | Total column of water vapour|
    +-----------------------------+---------------------+------------+-----------------------------+
    |       tcwv_flags            | dl                  | uint8      | TCWV flags                  |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    pixel_classif_flags      | dl                  | int16      | Pixel classification flags  |
    +-----------------------------+---------------------+------------+-----------------------------+

|vspace| |br|

CAWA CTP Products
-----------------

The CAWA CTP final products are generated in CF-compliant NetCDF4 format. They just contain the CTP, a simple
CTP flag and the pixel classification flag copied from the IdePix product (:numref:`ctp_bands`).
An example of the NetCDF header of a CTP product is given in the :ref:`annex`.

|vspace| |br|

.. _ctp_bands:
.. table:: Bands in final CAWA CTP product

    +-----------------------------+---------------------+------------+-----------------------------+
    |     **Name in product**     |       **Unit**      |   **Type** |        **Description**      |
    +=============================+=====================+============+=============================+
    |         ctp                 | mm                  | float32    | Cloud top pressure          |
    +-----------------------------+---------------------+------------+-----------------------------+
    |       ctp _flags            | dl                  | uint8      | CTP flags                   |
    +-----------------------------+---------------------+------------+-----------------------------+
    |    pixel_classif_flags      | dl                  | int16      | Pixel classification flags  |
    +-----------------------------+---------------------+------------+-----------------------------+






